<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Quicksand', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: transparent;
            padding: 10px;
            overflow: hidden;
        }

        .timer-controls {
            text-align: center;
        }

        .timer-display {
            font-size: 24px;
            font-weight: 700;
            color: #2a2d34;
            margin-bottom: 10px;
            font-family: 'Quicksand', monospace;
        }

        .timer-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            background: white;
            color: #2a2d34;
            border: 3px solid #2a2d34;
            padding: 10px 20px;
            border-radius: 20px;
            margin: 5px;
            cursor: pointer;
            font-weight: 700;
            font-family: 'Quicksand', sans-serif;
            transition: all 0.2s ease;
        }

        button:hover {
            background: #2a2d34;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        #timer-minutes {
            width: 60px;
            padding: 5px;
            border: 2px solid #2a2d34;
            border-radius: 8px;
            background: #F5F5F5;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            text-align: center;
        }

        /* Compact mode styles */
        @media (max-height: 250px) {
            .timer-controls {
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .timer-display { 
                font-size: 12px; 
                margin: 0;
                min-width: 50px;
                flex-shrink: 0;
            }
            .timer-buttons { 
                display: flex;
                flex-direction: row;
                gap: 4px; 
                flex-wrap: wrap;
                align-items: center;
            }
            .timer-buttons button { 
                padding: 3px 6px; 
                font-size: 9px; 
                white-space: nowrap;
            }
            #timer-minutes { 
                width: 45px; 
                font-size: 9px; 
                padding: 2px; 
            }
        }

        @media (max-width: 250px) {
            .timer-display { font-size: 12px; margin-bottom: 3px; }
            .timer-buttons { flex-direction: column; gap: 2px; }
            .timer-buttons button { width: 95%; margin: 1px auto; padding: 4px; font-size: 10px; }
            #timer-minutes { width: 95%; margin: 1px auto; font-size: 10px; padding: 2px; }
        }
    </style>
</head>
<body>
    <div class="timer-controls" id="timer-controls">
        <div class="timer-display" id="timer-display">25:00</div>
        <div class="timer-buttons">
            <button onclick="startTimer()">Start</button>
            <button onclick="pauseTimer()">Pause</button>
            <button onclick="resetTimer()">Reset</button>
            <input type="number" id="timer-minutes" min="1" max="120" value="25" 
                   onchange="setTimerMinutes(this.value)" placeholder="min">
        </div>
    </div>

    <script>
        // Timer System
        class TimerSystem {
            constructor() {
                this.totalSeconds = 25 * 60; // Default 25 minutes
                this.remainingSeconds = this.totalSeconds;
                this.isRunning = false;
                this.intervalId = null;
                this.displayElement = document.getElementById('timer-display');
                this.onTimerUpdate = null; // Callback for visual feedback
                this.onTimerComplete = null; // Callback for completion
            }
            
            formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            updateDisplay() {
                if (this.displayElement) {
                    this.displayElement.textContent = this.formatTime(this.remainingSeconds);
                }
                
                // Call visual feedback callback
                if (this.onTimerUpdate) {
                    const progress = 1 - (this.remainingSeconds / this.totalSeconds);
                    this.onTimerUpdate(progress, this.isRunning);
                }

                // Notify parent window
                if (window.parent && window.parent.timerUpdate) {
                    const progress = 1 - (this.remainingSeconds / this.totalSeconds);
                    window.parent.timerUpdate(progress, this.isRunning);
                }
            }
            
            start() {
                if (this.isRunning || this.remainingSeconds === 0) return;
                
                this.isRunning = true;
                this.intervalId = setInterval(() => {
                    this.remainingSeconds--;
                    this.updateDisplay();
                    
                    if (this.remainingSeconds === 0) {
                        this.complete();
                    }
                }, 1000);
                
                // Update parent status
                if (window.parent && window.parent.updateStatus) {
                    window.parent.updateStatus('Timer Running', 'warning');
                }
            }
            
            pause() {
                if (!this.isRunning) return;
                
                this.isRunning = false;
                if (this.intervalId) {
                    clearInterval(this.intervalId);
                    this.intervalId = null;
                }
                
                // Update parent status
                if (window.parent && window.parent.updateStatus) {
                    window.parent.updateStatus('Timer Paused', 'accent');
                }
            }
            
            reset() {
                this.pause();
                this.remainingSeconds = this.totalSeconds;
                this.updateDisplay();
                
                // Update parent status
                if (window.parent && window.parent.updateStatus) {
                    window.parent.updateStatus('Timer Ready', 'success');
                }
            }
            
            setDuration(minutes) {
                this.pause();
                this.totalSeconds = minutes * 60;
                this.remainingSeconds = this.totalSeconds;
                this.updateDisplay();
            }
            
            complete() {
                this.isRunning = false;
                if (this.intervalId) {
                    clearInterval(this.intervalId);
                    this.intervalId = null;
                }
                
                // Update parent status
                if (window.parent && window.parent.updateStatus) {
                    window.parent.updateStatus('Timer Complete!', 'success');
                }
                
                // Play completion sound
                this.playCompletionSound();
                
                // Call completion callback
                if (this.onTimerComplete) {
                    this.onTimerComplete();
                }

                // Notify parent of completion
                if (window.parent && window.parent.timerComplete) {
                    window.parent.timerComplete();
                }
                
                // Auto-reset after a few seconds
                setTimeout(() => {
                    this.reset();
                }, 3000);
            }
            
            playCompletionSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.2);
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (error) {
                    console.log('Could not play completion sound:', error);
                }
            }
        }

        // Global timer instance
        let timer = new TimerSystem();

        // Global timer functions
        window.startTimer = function() {
            timer.start();
        };

        window.pauseTimer = function() {
            timer.pause();
        };

        window.resetTimer = function() {
            timer.reset();
        };

        window.setTimerMinutes = function(minutes) {
            const mins = Math.max(1, Math.min(120, parseInt(minutes) || 25));
            timer.setDuration(mins);
            document.getElementById('timer-minutes').value = mins;
        };

        // Expose timer instance to parent
        window.timer = timer;
    </script>
</body>
</html>